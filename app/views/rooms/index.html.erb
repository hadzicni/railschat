<div class="container">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-body text-center py-4">
          <h2 class="mb-2">
            <i class="bi bi-chat-dots-fill me-2"></i>
            RailsChat
          </h2>
          <p class="text-muted mb-0">Wähle einen Chatraum oder erstelle einen neuen</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Rooms List -->
    <div class="col-lg-8 mb-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Verfügbare Chaträume</h4>
        <span class="badge bg-secondary">
          <%= @rooms.count %> <%= @rooms.count == 1 ? 'Raum' : 'Räume' %>
        </span>
      </div>

      <% if @rooms.any? %>
        <div class="row">
          <% @rooms.each do |room| %>
            <div class="col-md-6 mb-3">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title">
                    <i class="bi bi-chat-square-text me-2"></i>
                    <%= room.name %>
                  </h5>
                  <p class="card-text text-muted small">
                    <i class="bi bi-people me-1"></i>
                    <%= room.messages.select(:user_id).distinct.count %> Teilnehmer
                  </p>

                  <% if room.description.present? %>
                    <p class="card-text text-muted mb-3">
                      <%= truncate(room.description, length: 100) %>
                    </p>
                  <% end %>

                                    <p class="card-text text-muted small">
                    <i class="bi bi-chat me-1"></i>
                    <%= room.messages.count %> <%= room.messages.count == 1 ? 'Nachricht' : 'Nachrichten' %>
                  </p>
                  <% if room.messages.any? %>
                    <small class="text-muted">
                      Zuletzt aktiv: <%= time_ago_in_words(room.messages.maximum(:created_at)) %> ago
                    </small>
                  <% else %>
                    <small class="text-muted">Neu</small>
                  <% end %>

                  <div class="mt-3">
                    <%= link_to room_path(room), class: "btn btn-primary" do %>
                      <i class="bi bi-arrow-right me-1"></i>
                      Betreten
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="card">
          <div class="card-body text-center py-4">
            <i class="bi bi-chat-square-dots fs-2 text-muted mb-3"></i>
            <h6 class="text-muted mb-2">Noch keine Chaträume vorhanden</h6>
            <p class="text-muted small">Erstelle den ersten Chatraum!</p>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Create Room Sidebar -->
    <div class="col-lg-4">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="bi bi-plus-circle me-2"></i>
            Neuen Chatraum erstellen
          </h6>
        </div>
        <div class="card-body">
          <%= form_with model: @room, local: true do |form| %>
            <% if @room.errors.any? %>
              <div class="alert alert-danger alert-sm">
                <small>
                  <%= @room.errors.count %> <%= @room.errors.count == 1 ? 'Fehler' : 'Fehler' %>:
                  <% @room.errors.full_messages.each do |message| %>
                    <%= message %>
                  <% end %>
                </small>
              </div>
            <% end %>

            <div class="mb-3">
              <%= form.label :name, "Raumname", class: "form-label" %>
              <%= form.text_field :name, class: "form-control", placeholder: "z.B. Allgemein, Gaming, Technik..." %>
            </div>

            <div class="mb-3">
              <%= form.label :description, "Beschreibung (optional)", class: "form-label" %>
              <%= form.text_area :description, class: "form-control", rows: 3,
                  placeholder: "Beschreibe worum es in diesem Chatraum geht..." %>
            </div>

            <%= form.submit "Chatraum erstellen", class: "btn btn-success" %>
          <% end %>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="card mt-4">
        <div class="card-header">
          <h6 class="mb-0">
            <i class="bi bi-graph-up me-2"></i>
            Statistiken
          </h6>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6 border-end">
              <div class="bg-primary bg-opacity-10 rounded p-2 mb-2">
                <i class="bi bi-door-open text-primary fs-4"></i>
              </div>
              <h6 class="mb-0"><%= Room.count %></h6>
              <small class="text-muted">Räume</small>
            </div>
            <div class="col-6">
              <div class="bg-success bg-opacity-10 rounded p-2 mb-2">
                <i class="bi bi-chat-text text-success fs-4"></i>
              </div>
              <h6 class="mb-0"><%= Message.count %></h6>
              <small class="text-muted">Nachrichten</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
